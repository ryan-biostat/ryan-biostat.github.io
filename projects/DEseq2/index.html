<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Differential Expression Analysis | Ryan Gallagher </title> <meta name="author" content="Ryan Gallagher"> <meta name="description" content="for drug discovery using DESeq2 in R"> <meta name="keywords" content="biostatistics, statistical genetics, genomics, genome assembly, bioinformatics, Ryan Gallagher"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%A7%AC&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://ryan-biostat.github.io/projects/DEseq2/"> <script src="/assets/js/theme.js?a81d82887dd692e91686b43de4542f18"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Ryan</span> Gallagher </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">projects <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link" href="https://github.com/ryan-biostat/ryan-biostat.github.io/tree/main/assets/pdf/RG_CV_11082025.pdf" rel="external nofollow noopener" target="_blank">cv </a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">teaching </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/presentations/">presentations </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Differential Expression Analysis</h1> <p class="post-description">for drug discovery using DESeq2 in R</p> </header> <article> <h4 id="about"><strong>About</strong></h4> <p>I’m part of a grant-funded project studying how different drugs change gene expression in the human genome. It’s been a great crash course in how RNA behaves and how we can actually measure those changes in real data.</p> <p>On this project I’ve gotten hands-on experience working with expression data, collaborating with people from different disciplines, and communicating results clearly. One hallmark of this project was weekly presentations of findings to our group of experts, this was a slightly intimidating but really rewarding experience that helped me build a lot of confidence in my scientific communication and teamwork skills. The insights from my analysis have already helped shape the next steps of the research, and the project is still actively moving forward.</p> <h2 id="purpose"><strong>Purpose</strong></h2> <p>Tyrosine kinase inhibitors (TKIs) are a class of targeted cancer therapies that block enzymes called tyrosine kinases, which help control cell signaling, growth, and division. According to the <a href="https://www.cancer.gov/publications/dictionaries/cancer-terms/def/tyrosine-kinase-inhibitor?utm_source=chatgpt.com" rel="external nofollow noopener" target="_blank">National Cancer Institute</a>, these enzymes can be overactive or dysregulated in some cancers, and inhibiting them can slow tumor growth and promote cancer cell death.</p> <p>In this project, I used <a href="https://bioconductor.org/packages/release/bioc/html/DESeq2.html" rel="external nofollow noopener" target="_blank">DESeq2</a>, an R/Bioconductor package for RNA-seq differential expression analysis, to quantify how gene expression changed across cell types, drugs, and doses. This method models count data with a negative binomial distribution and uses moderated estimates of dispersion and fold change to identify genes that are significantly up- or down-regulated between conditions. After generating lists of differentially expressed genes, I performed pathway and gene-set enrichment analysis using <a href="https://bioinformatics.sdstate.edu/go/" rel="external nofollow noopener" target="_blank">ShinyGO</a> and the <a href="https://www.genome.jp/kegg/" rel="external nofollow noopener" target="_blank">KEGG</a> database. ShinyGO, developed at South Dakota State University, provides graphical enrichment analysis and integrates with KEGG and other resources to map gene lists onto functional categories and pathways. Together, DESeq2-based differential expression and pathway analysis allowed me to move from raw RNA counts to an interpretation about how TKIs influence cellular pathways.</p> <h2 id="methods"><strong>Methods</strong></h2> <p>Analysis was performed via the following steps:</p> <ol> <li> <h4 id="data-accumulation"><strong>Data Accumulation</strong></h4> <p>Lab members treated cells with several different TKIs at a range of doses to see how their gene expression would change. After treatment, the cells were collected and processed for RNA extraction using standard molecular biology workflows. The extracted RNA was then quantified and sequenced to generate count data representing gene expression levels under each treatment condition.</p> </li> <li> <h4 id="data-normalization"><strong>Data Normalization</strong></h4> <p>The RNA-seq data were structured as a gene-by-sample count matrix, with genes as rows, samples as columns, and raw read counts in each cell. Because sequencing depth and compositional differences vary across samples, normalization was necessary before making meaningful comparisons. To address this, I implemented DESeq2’s <a href="https://bioconductor.org/packages/devel/bioc/vignettes/DESeq2/inst/doc/DESeq2.html" rel="external nofollow noopener" target="_blank"><em>median-of-ratios</em></a> normalization, which calculates sample-specific size factors by comparing each sample’s counts to a pseudo-reference derived from gene-wise geometric means. By applying these size factors through the DESeq2 pipeline, I ensured that the normalized counts were appropriately scaled and ready for differential expression analysis.</p> </li> <li> <h4 id="deseq2"><strong>DESeq2</strong></h4> <p>To perform the differential expression (DE) analysis, I implemented a workflow in R using the <strong>DESeq2</strong> package. After importing the raw count matrix and corresponding metadata, I first stratified the samples into <em>resistant</em> and <em>sensitive</em> groups based on their annotated cell-line classifications. I then filtered out low-abundance genes by removing any gene whose median count across samples was ≤10. This step reduces noise and improves stability in the model estimation.</p> <p>For each tyrosine kinase inhibitor (TKI) and dose combination, I constructed a DESeq2 dataset containing only the relevant treated samples. In the unpaired analysis, I modeled gene expression using a simple design formula <code class="language-plaintext highlighter-rouge">~ Class</code>, which tests for differences between resistant and sensitive groups within each treatment condition.</p> <p>I also implemented an extended <strong>paired-controls design</strong> to account for baseline expression. In this version of the analysis, the treated samples were combined with their plate-matched DMSO controls. I then used the design formula <code class="language-plaintext highlighter-rouge">~ treatment + Class</code>, which adjusts for untreated-versus-treated differences before estimating the resistant-versus-sensitive contrast. This allowed the analysis to isolate differences driven specifically by the drug response rather than preexisting variation.</p> <p>DESeq2’s pipeline handled dispersion estimation and fitting of the negative binomial models. For each analysis, I extracted the ordered results table and exported it as a <code class="language-plaintext highlighter-rouge">.tsv</code> file for downstream interpretation and pathway enrichment analysis.</p> </li> <li> <h4 id="pathway-analysis"><strong>Pathway Analysis</strong></h4> <p>After generating the differential expression results for each TKI and dose combination, I performed pathway enrichment analysis to interpret the biological patterns underlying the gene-level changes. For each experiment, I extracted the list of significantly differentially expressed genes and uploaded it to <strong>ShinyGO</strong>, an online enrichment platform that integrates Gene Ontology terms, KEGG pathways, and other functional annotation resources.</p> <p>ShinyGO provided ranked lists of enriched pathways, along with statistical metrics such as fold enrichment and adjusted p-values. I downloaded these results for every TKI–dose pair and then processed them in R to create visual summaries. Using these outputs, I generated figures highlighting the top enriched pathways for each experimental condition. These visualizations helped compare how different TKIs and doses perturbed cellular signaling and functional processes, and they provided a higher-level interpretation of the transcriptomic responses identified in the DESeq2 analysis.</p> </li> </ol> <h2 id="code-sample"><strong>Code Sample</strong></h2> <p>The following code displays the core script for running differential expression analysis via DESeq2:</p> <figure class="highlight"><pre><code class="language-r" data-lang="r"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
</pre></td> <td class="code"><pre><span class="c1"># Ryan Gallagher</span><span class="w">

</span><span class="c1">#   Goal: This script will:</span><span class="w">
</span><span class="c1">##          1. Import and stratify by group</span><span class="w">
</span><span class="c1">##          2. Remove low abundant genes</span><span class="w">
</span><span class="c1">##          3. DESeq2 of Resistant vs. Sensitive for each trt+dosage</span><span class="w">
</span><span class="c1">##          4. Output as .tsv files in the analysis folder</span><span class="w">
</span><span class="c1">#</span><span class="w">
</span><span class="c1">#             In this approach, we incorporate control samples to account for baseline expression levels before comparing </span><span class="w">
</span><span class="c1">#             resistant and sensitive groups. This helps remove genes that are already differentially </span><span class="w">
</span><span class="c1">#             expressed at baseline (before treatment) and focuses on treatment-induced differences </span><span class="w">
</span><span class="c1">#             between resistant and sensitive samples.</span><span class="w">


</span><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">DESeq2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">matrixStats</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">readxl</span><span class="p">)</span><span class="w">

</span><span class="n">cts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="s2">"../data/TKI_phaseI_raw_read_counts_913_samples_final.txt"</span><span class="p">)</span><span class="w">
</span><span class="n">cts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.matrix</span><span class="p">(</span><span class="n">cts</span><span class="p">)</span><span class="w">

</span><span class="n">meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read_excel</span><span class="p">(</span><span class="s2">"../data/metadata/TKI Phase I samples to use for analysis.xlsx"</span><span class="p">,</span><span class="w"> </span><span class="n">sheet</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="n">meta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">meta</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">treatment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">Group</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"DMSO"</span><span class="p">,</span><span class="s2">"untreated"</span><span class="p">,</span><span class="w"> </span><span class="s2">"treated"</span><span class="p">))</span><span class="w">
</span><span class="n">meta</span><span class="o">$</span><span class="n">treatment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">meta</span><span class="o">$</span><span class="n">treatment</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"untreated"</span><span class="p">,</span><span class="w"> </span><span class="s2">"treated"</span><span class="p">))</span><span class="w">

</span><span class="n">cell_lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">sort</span><span class="p">(</span><span class="n">sub</span><span class="p">(</span><span class="s2">"_.*"</span><span class="p">,</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">colnames</span><span class="p">(</span><span class="n">cts</span><span class="p">))))</span><span class="w">
</span><span class="n">KIs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">na.omit</span><span class="p">(</span><span class="n">str_extract</span><span class="p">(</span><span class="n">colnames</span><span class="p">(</span><span class="n">cts</span><span class="p">),</span><span class="w"> </span><span class="s2">"(?&lt;=_)[A-Z]+(?=_)"</span><span class="p">)))</span><span class="w">
</span><span class="n">dosage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"1x"</span><span class="p">,</span><span class="w"> </span><span class="s2">"3x"</span><span class="p">,</span><span class="w"> </span><span class="s2">"10x"</span><span class="p">)</span><span class="w">

</span><span class="c1">## The cell lines:</span><span class="w">
</span><span class="n">sensitive.3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"c1120"</span><span class="p">,</span><span class="w"> </span><span class="s2">"c1343"</span><span class="p">,</span><span class="w"> </span><span class="s2">"c1367"</span><span class="p">)</span><span class="w">
</span><span class="n">resistant.3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"c1254"</span><span class="p">,</span><span class="w"> </span><span class="s2">"c1297"</span><span class="p">,</span><span class="w"> </span><span class="s2">"c1115"</span><span class="p">)</span><span class="w">

</span><span class="n">meta.filtered</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">meta</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">str_detect</span><span class="p">(</span><span class="n">SampleName</span><span class="p">,</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="s2">"^("</span><span class="p">,</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">sensitive.3</span><span class="p">,</span><span class="w"> </span><span class="n">resistant.3</span><span class="p">),</span><span class="w"> </span><span class="n">collapse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"|"</span><span class="p">),</span><span class="w"> </span><span class="s2">")"</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">Class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">CellLine</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">resistant.3</span><span class="p">,</span><span class="w"> </span><span class="s1">'resistant'</span><span class="p">,</span><span class="w"> </span><span class="s1">'sensitive'</span><span class="p">))</span><span class="w">
</span><span class="n">cts.filtered</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cts</span><span class="p">[,</span><span class="w"> </span><span class="n">colnames</span><span class="p">(</span><span class="n">cts</span><span class="p">)</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">meta.filtered</span><span class="o">$</span><span class="n">SampleName</span><span class="p">]</span><span class="w">

</span><span class="c1">## Separate Controls and Treatments</span><span class="w">
</span><span class="n">meta.controls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">meta.filtered</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">Group</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'DMSO'</span><span class="p">)</span><span class="w">
</span><span class="n">cts.controls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cts.filtered</span><span class="p">[,</span><span class="w"> </span><span class="n">colnames</span><span class="p">(</span><span class="n">cts.filtered</span><span class="p">)</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">meta.controls</span><span class="o">$</span><span class="n">SampleName</span><span class="p">]</span><span class="w">

</span><span class="n">meta.treatments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">meta.filtered</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">Group</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">"DMSO"</span><span class="p">)</span><span class="w">
</span><span class="n">cts.treatments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cts.filtered</span><span class="p">[,</span><span class="w"> </span><span class="n">colnames</span><span class="p">(</span><span class="n">cts.filtered</span><span class="p">)</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">meta.treatments</span><span class="o">$</span><span class="n">SampleName</span><span class="p">]</span><span class="w">


</span><span class="n">RvS_DESeq2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">KI</span><span class="p">,</span><span class="w"> </span><span class="n">dose</span><span class="p">,</span><span class="w"> </span><span class="n">paired</span><span class="o">=</span><span class="nb">F</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">

  </span><span class="c1"># Check inputs</span><span class="w">
  </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nf">is.character</span><span class="p">(</span><span class="n">KI</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">!</span><span class="nf">is.character</span><span class="p">(</span><span class="n">dose</span><span class="p">))</span><span class="w"> </span><span class="nf">return</span><span class="p">(</span><span class="kc">NULL</span><span class="p">)</span><span class="w">

  </span><span class="n">meta.instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">meta.treatments</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">Condition</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">KI</span><span class="p">,</span><span class="w"> </span><span class="n">Group</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">dose</span><span class="p">)</span><span class="w">
  </span><span class="n">cts.instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cts.treatments</span><span class="p">[,</span><span class="w"> </span><span class="n">match</span><span class="p">(</span><span class="n">meta.instance</span><span class="o">$</span><span class="n">SampleName</span><span class="p">,</span><span class="w"> </span><span class="n">colnames</span><span class="p">(</span><span class="n">cts.treatments</span><span class="p">))]</span><span class="w">
  </span><span class="n">meta.instance</span><span class="o">$</span><span class="n">Class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">meta.instance</span><span class="o">$</span><span class="n">Class</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s1">'resistant'</span><span class="p">,</span><span class="w"> </span><span class="s1">'sensitive'</span><span class="p">))</span><span class="w">

  </span><span class="c1">## REMOVE LOW ABUNDANCE</span><span class="w">
  </span><span class="n">d1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">cts.instance</span><span class="p">)</span><span class="w">
  </span><span class="n">gene.medians</span><span class="o">=</span><span class="n">rowMedians</span><span class="p">(</span><span class="n">as.matrix</span><span class="p">(</span><span class="n">cts.instance</span><span class="p">))</span><span class="w">

  </span><span class="c1">## get the indexes of the genes with less than 10 median read count</span><span class="w">
  </span><span class="n">index.lowCountGenes</span><span class="o">=</span><span class="n">which</span><span class="p">(</span><span class="n">gene.medians</span><span class="o">&lt;=</span><span class="m">10</span><span class="p">)</span><span class="w">

  </span><span class="c1">## remove these low abundance genes</span><span class="w">
  </span><span class="n">cts.instance</span><span class="o">=</span><span class="n">cts.instance</span><span class="p">[</span><span class="o">-</span><span class="n">index.lowCountGenes</span><span class="p">,]</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">paired</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">F</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">d2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">cts.instance</span><span class="p">)</span><span class="w">
  </span><span class="n">print</span><span class="p">(</span><span class="n">paste</span><span class="p">(</span><span class="s2">"Low Abdundance Filtering Removed:"</span><span class="p">,</span><span class="w"> </span><span class="n">d1</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="o">-</span><span class="n">d2</span><span class="p">[</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="s2">"Gene Rows."</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s1">' '</span><span class="p">))</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="c1">#Skip if no other classification group</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">meta.instance</span><span class="o">$</span><span class="n">Class</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nf">return</span><span class="p">(</span><span class="s2">"skipping"</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">

  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">meta.instance</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">6</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">directory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"REDACTED"</span><span class="w">
  </span><span class="p">}</span><span class="w">

  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">meta.instance</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="m">6</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">directory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"REDACTED"</span><span class="w">
  </span><span class="p">}</span><span class="w">

  </span><span class="n">dds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DESeqDataSetFromMatrix</span><span class="p">(</span><span class="n">countData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cts.instance</span><span class="p">,</span><span class="w">
                               </span><span class="n">colData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">meta.instance</span><span class="p">,</span><span class="w">
                               </span><span class="n">design</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Class</span><span class="p">)</span><span class="w"> 

  </span><span class="n">file.name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span><span class="w"> </span><span class="s2">"/"</span><span class="p">,</span><span class="w"> </span><span class="n">KI</span><span class="p">,</span><span class="w"> </span><span class="s2">"_"</span><span class="p">,</span><span class="w"> </span><span class="n">dose</span><span class="p">,</span><span class="w"> </span><span class="s2">".tsv"</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s1">''</span><span class="p">)</span><span class="w">

  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">paired</span><span class="o">==</span><span class="nb">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">meta.controls.instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">meta.controls</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">Plate</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">meta.instance</span><span class="o">$</span><span class="n">Plate</span><span class="p">))</span><span class="w">
    </span><span class="n">cts.controls.instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cts.controls</span><span class="p">[,</span><span class="w"> </span><span class="n">colnames</span><span class="p">(</span><span class="n">cts.controls</span><span class="p">)</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">meta.controls.instance</span><span class="o">$</span><span class="n">SampleName</span><span class="p">]</span><span class="w">
    
    </span><span class="n">plate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">meta.instance</span><span class="o">$</span><span class="n">Plate</span><span class="p">)</span><span class="w">
    
    </span><span class="n">meta.instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bind_rows</span><span class="p">(</span><span class="n">meta.instance</span><span class="p">,</span><span class="w"> </span><span class="n">meta.controls.instance</span><span class="p">)</span><span class="w">
    </span><span class="n">cts.instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cts.filtered</span><span class="p">[,</span><span class="w"> </span><span class="n">match</span><span class="p">(</span><span class="n">meta.instance</span><span class="o">$</span><span class="n">SampleName</span><span class="p">,</span><span class="w"> </span><span class="n">colnames</span><span class="p">(</span><span class="n">cts.filtered</span><span class="p">))]</span><span class="w">
    </span><span class="n">meta.instance</span><span class="o">$</span><span class="n">Class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">meta.instance</span><span class="o">$</span><span class="n">Class</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s1">'resistant'</span><span class="p">,</span><span class="w"> </span><span class="s1">'sensitive'</span><span class="p">))</span><span class="w">
    </span><span class="n">meta.instance</span><span class="o">$</span><span class="n">treatment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">meta.instance</span><span class="o">$</span><span class="n">treatment</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s1">'untreated'</span><span class="p">,</span><span class="w"> </span><span class="s1">'treated'</span><span class="p">))</span><span class="w">
    
    </span><span class="n">print</span><span class="p">(</span><span class="n">paste</span><span class="p">(</span><span class="s2">"# of Genes in Table"</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">cts.instance</span><span class="p">)))</span><span class="w">
    
    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">meta.instance</span><span class="o">$</span><span class="n">treatment</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nf">return</span><span class="p">(</span><span class="s2">"skipping"</span><span class="p">)</span><span class="w">
    </span><span class="p">}</span><span class="w">


</span><span class="err">​</span><span class="w">    
</span><span class="err">​</span><span class="w">    </span><span class="c1">## REMOVE LOW ABUNDANCE</span><span class="w">
</span><span class="err">​</span><span class="w">    </span><span class="n">d1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">cts.instance</span><span class="p">)</span><span class="w">
</span><span class="err">​</span><span class="w">    </span><span class="n">gene.medians</span><span class="o">=</span><span class="n">rowMedians</span><span class="p">(</span><span class="n">as.matrix</span><span class="p">(</span><span class="n">cts.instance</span><span class="p">))</span><span class="w">
</span><span class="err">​</span><span class="w">    </span><span class="n">index.lowCountGenes</span><span class="o">=</span><span class="n">which</span><span class="p">(</span><span class="n">gene.medians</span><span class="o">&lt;=</span><span class="m">10</span><span class="p">)</span><span class="w">
</span><span class="err">​</span><span class="w">    </span><span class="n">cts.instance</span><span class="o">=</span><span class="n">cts.instance</span><span class="p">[</span><span class="o">-</span><span class="n">index.lowCountGenes</span><span class="p">,]</span><span class="w">
</span><span class="err">​</span><span class="w">    </span><span class="n">d2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">cts.instance</span><span class="p">)</span><span class="w">
</span><span class="err">​</span><span class="w">    </span><span class="n">print</span><span class="p">(</span><span class="n">paste</span><span class="p">(</span><span class="s2">"Low Abdundance Filtering Removed:"</span><span class="p">,</span><span class="w"> </span><span class="n">d1</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="o">-</span><span class="n">d2</span><span class="p">[</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="s2">"Gene Rows."</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s1">' '</span><span class="p">))</span><span class="w">
</span><span class="err">​</span><span class="w">      
</span><span class="err">​</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">meta.instance</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">12</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="err">​</span><span class="w">      </span><span class="n">directory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"REDACTED"</span><span class="w">
</span><span class="err">​</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="err">​</span><span class="w">    
</span><span class="err">​</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">meta.instance</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="m">12</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="err">​</span><span class="w">      </span><span class="n">directory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"REDACTED"</span><span class="w">
</span><span class="err">​</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="err">​</span><span class="w">    
    </span><span class="n">dds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DESeqDataSetFromMatrix</span><span class="p">(</span><span class="n">countData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cts.instance</span><span class="p">,</span><span class="w">
                                 </span><span class="n">colData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">meta.instance</span><span class="p">,</span><span class="w">
                                 </span><span class="n">design</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">treatment</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Class</span><span class="p">)</span><span class="w">
    
    </span><span class="n">file.name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span><span class="w"> </span><span class="s2">"/"</span><span class="p">,</span><span class="w"> </span><span class="n">KI</span><span class="p">,</span><span class="w"> </span><span class="s2">"_"</span><span class="p">,</span><span class="w"> </span><span class="n">dose</span><span class="p">,</span><span class="w"> </span><span class="s2">"_paired.tsv"</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s1">''</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">

  </span><span class="n">print</span><span class="p">(</span><span class="s2">"Beginning DESeq Functon"</span><span class="p">)</span><span class="w">

  </span><span class="n">dds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DESeq</span><span class="p">(</span><span class="n">dds</span><span class="p">)</span><span class="w">
  </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">results</span><span class="p">(</span><span class="n">dds</span><span class="p">)</span><span class="w">
  </span><span class="n">resOrdered</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span><span class="p">[</span><span class="n">order</span><span class="p">(</span><span class="n">res</span><span class="o">$</span><span class="n">pvalue</span><span class="p">),]</span><span class="w">

  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">dir.exists</span><span class="p">(</span><span class="n">directory</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">dir.create</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span><span class="w"> </span><span class="n">recursive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">


  </span><span class="n">print</span><span class="p">(</span><span class="n">file.name</span><span class="p">)</span><span class="w">
  </span><span class="n">write.table</span><span class="p">(</span><span class="n">cbind</span><span class="p">(</span><span class="n">Genes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rownames</span><span class="p">(</span><span class="n">resOrdered</span><span class="p">),</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">resOrdered</span><span class="p">)),</span><span class="w"> 
              </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file.name</span><span class="p">,</span><span class="w"> 
              </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"\t"</span><span class="p">,</span><span class="w"> 
              </span><span class="n">quote</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> 
              </span><span class="n">row.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">KIs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">meta.treatments</span><span class="o">$</span><span class="n">Condition</span><span class="p">)</span><span class="w">
</span><span class="n">dosings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">meta.treatments</span><span class="o">$</span><span class="n">Group</span><span class="p">)</span><span class="w">

</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">KI</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">KIs</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">doses</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">dosings</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">RvS_DESeq2</span><span class="p">(</span><span class="n">KI</span><span class="p">,</span><span class="w"> </span><span class="n">doses</span><span class="p">,</span><span class="w"> </span><span class="n">paired</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span>
</pre></td> </tr></tbody></table></code></pre></figure> <p>After pathway enrichment, multiple figures (as below) were generated for presentation.</p> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/pathway_img-480.webp 480w,/assets/img/pathway_img-800.webp 800w,/assets/img/pathway_img-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/pathway_img.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="pathway Image" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </article> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Ryan Gallagher. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with the <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme, hosted on <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?c15de51d4bb57887caa2c21988d97279"></script> <script defer src="/assets/js/copy_code.js?c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> </body> </html>